<!doctype html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="../../css/bootstrap.css">
    <link href="../../css/all.min.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="../../css/bootstrap-table.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css"
          integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
    <link href="../../css/bootstrap-datetimepicker.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.14.1/dist/bootstrap-table.min.css">
</head>

<body>
<!--Tool Bar-->
<div id="toolbar" class="btn-group">
    <button id="btn_add" type="button" onclick="createForm(this)" class="btn btn-default">
        <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>新增
    </button>
</div>
<!--Data Tables-->
<table id="Grid"></table>
<!--Create Modal-->
<div class="modal fade" style="margin-top: 10%" id="create_Modal" tabindex="-1" role="dialog" aria-labelledby="e_title" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <!--header-->
            <div class="modal-header">
                <div class="row">
                    <div class="col-xs-6">
                    <h3 class="modal-title" id="c_title">新增申请表</h3>
                    </div>
                    <div class="col-xs-6">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true" >
                            <span class="glyphicon glyphicon-share"></span>
                        </button>
                    </div>
                </div>
            </div>
            <!--body-->
            <div class="modal-body">
                <form class="form-horizontal" id="modal_create">
                    <!-- id & title-->
                    <div class="form-group">
                        <div class="row">
                            <!--Title-->
                            <div class="col-xs-12">
                                <label class="col-md-2 control-label" style="text-align: left">活动标题</label>
                                <div class="col-md-10">
                                    <input type="text" class="form-control" name="appTitle">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="dropdown-divider"/>

                    <!-- time-->
                    <div class="form-group">
                        <div class="row">
                            <!--Start Time-->
                            <div class="col-xs-6">
                                <label class="col-md-3 control-label" style="text-align: left">开始日期</label>
                                <div class="col-md-9">
                                    <input type='text' class="form-control date" name="startTime"/>
                                </div>
                            </div>
                            <!--End Time-->
                            <div class="col-xs-6">
                                <label class="col-md-3 control-label" style="text-align: left">结束日期</label>
                                <div class="col-md-9">
                                    <input type='text' class="form-control date" name="endTime"/>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="dropdown-divider"/>

                    <!--attendance & place-->
                    <div class="form-group">
                        <div class="row">
                            <!--attendance-->
                            <div class="col-xs-6">
                                <label class="col-md-3 control-label" style="text-align: left">参与人数</label>
                                <div class="col-md-9">
                                    <input type="text" class="form-control" name="attendance" placeholder="输入人数">
                                </div>
                            </div>
                            <!--occupy place-->
                            <div class="col-xs-6">
                                <label class="col-md-3 control-label" style="text-align: left">占用场地</label>
                                <div class="col-md-9">
                                    <select id="c_placeId" class="form-control"></select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="dropdown-divider"/>

                    <div class="form-group">
                        <label class="col-md-12 control-label" style="text-align: left">活动描述</label>
                        <div class="col-md-12">
                            <textarea type="text" class="form-control" name="appDesc" rows="3"></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <!--footer-->
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="commitCreate()">提交</button>
            </div>
        </div>
    </div>
</div>
<!--Edit Modal-->
<div class="modal fade" style="margin-top: 10%" id="edit_Modal" tabindex="-1" role="dialog" aria-labelledby="e_title" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <!--header-->
            <div class="modal-header">
                <div class="row">
                    <div class="col-xs-6">
                        <h3 class="modal-title" id="e_title">修改申请表</h3>
                    </div>
                    <div class="col-xs-6">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true" >
                            <span class="glyphicon glyphicon-share"></span>
                        </button>
                    </div>
                </div>
            </div>
            <!--body-->
            <div class="modal-body">
                <form class="form-horizontal" id="modal_edit">
                    <!-- id & title-->
                    <div class="form-group">
                        <div class="row">
                            <!--ID-->
                            <div class="col-xs-6">
                                <label class="col-md-3 control-label" style="text-align: left">表单ID</label>
                                <div class="col-md-9">
                                    <input type="text" class="form-control" name="formId" readonly>
                                </div>
                            </div>
                            <!--Title-->
                            <div class="col-xs-6">
                                <label class="col-md-3 control-label" style="text-align: left">活动标题</label>
                                <div class="col-md-9">
                                    <input type="text" class="form-control" name="appTitle">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="dropdown-divider"/>

                    <!-- time-->
                    <div class="form-group">
                        <div class="row">
                            <!--Start Time-->
                            <div class="col-xs-6">
                                <label class="col-md-3 control-label" style="text-align: left">开始日期</label>
                                <div class="col-md-9">
                                    <input type='text' class="form-control date" name="startTime"/>
                                </div>
                            </div>
                            <!--End Time-->
                            <div class="col-xs-6">
                                <label class="col-md-3 control-label" style="text-align: left">结束日期</label>
                                <div class="col-md-9">
                                    <input type='text' class="form-control date" name="endTime"/>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="dropdown-divider"/>

                    <!--attendance & place-->
                    <div class="form-group">
                        <div class="row">
                            <!--attendance-->
                            <div class="col-xs-6">
                                <label class="col-md-3 control-label" style="text-align: left">参与人数</label>
                                <div class="col-md-9">
                                    <input type="text" class="form-control" name="attendance" placeholder="输入人数">
                                </div>
                            </div>
                            <!--occupy place-->
                            <div class="col-xs-6">
                                <label class="col-md-3 control-label" style="text-align: left">占用场地</label>
                                <div class="col-md-9">
                                    <select id="e_placeId" class="form-control"></select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="dropdown-divider"/>

                    <div class="form-group">
                        <label class="col-md-12 control-label" style="text-align: left">活动描述</label>
                        <div class="col-md-12">
                            <textarea type="text" class="form-control" name="appDesc" rows="3"></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <!--footer-->
            <div class="modal-footer">
                <a id="btn_delete" type="button" style="float: left;cursor:pointer;">
                    <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true">删除该申请</span>
                </a>
                <button type="button" class="btn btn-primary" onclick="commitUpdate()">提交</button>
            </div>
        </div>
    </div>
</div>
<!--Js Files-->
<script src="../../js/jquery-3.3.1.js"></script>
<script src="../../js/bootstrap.js"></script>
<script src="../../js/Demo/bootstrap-table.js"></script>
<script src="../../js/Demo/bootstrap-table-zh-CN.js"></script>
<script src="../../js/bootstrap-datetimepicker.js"></script>
<script src="../../js/bootstrap-datetimepicker.zh-CN.js" charset="UTF-8"></script>
<script src="../https://unpkg.com/bootstrap-table@1.14.1/dist/bootstrap-table.min.js"></script>
<script src="../../js/global-common.js"></script>
<script type="text/javascript" charset="UTF-8">
    $(function () {
        //初始化日期选择器
        initDatePicker();
        //初始化场地下拉列表
        initPlaceList();
    })

    window.operateEvents = {
        "click #editBtn": function (e, value, row, index) {
        }
    };

    //Tables Init
    $("#Grid").bootstrapTable({
        url: BaseUrl + 'cams/app/getAllFormByUser', //请求后台的URL（*）
        method: 'get',                              //请求方式（*）
        toolbar: '#toolbar',                        //工具按钮用哪个容器
        striped: true,                              //是否显示行间隔色
        cache: false,                               //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
        pagination: true,                           //是否显示分页（*）
        sortable: true,                             //是否启用排序
        sortOrder: "asc",                           //排序方式
        // queryParams: oTableInit.queryParams,        //传递参数（*）
        sidePagination: "client",                   //分页方式：client客户端分页，server服务端分页（*）
        pageNumber: 1,                               //初始化加载第一页，默认第一页
        pageSize: 5,                                //每页的记录行数（*）
        pageList: [5, 10, 25, 50],                      //可供选择的每页的行数（*）
        search: true,                               //是否显示表格搜索，此搜索是客户端搜索，不会进服务端，所以，个人感觉意义不大
        strictSearch: true,                         //匹配查询
        showColumns: true,                          //是否显示所有的列
        showRefresh: true,                          //是否显示刷新按钮
        minimumCountColumns: 3,                     //最少允许的列数
        clickToSelect: true,                        //是否启用点击选中行
        // height: 500,                                //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
        uniqueId: "formId",                             //每一行的唯一标识，一般为主键列
        showToggle: false,                            //是否显示详细视图和列表视图的切换按钮
        cardView: false,                            //是否显示详细视图
        detailView: false,                          //是否显示父子表
        singleSelect: false,                       //是否单选
        columns: [
            {
                field: 'formId',
                title: '编号',
                width: '30px',
                sortable: true
            },
            {
                field: 'appTitle',
                title: '标题',
                sortable: true
            },
            {
                field: 'startTime',
                title: '开始日期',
                sortable: true
            },
            {
                field: 'endTime',
                title: '结束日期',
                sortable: true
            },
            {
                field: 'placeName',
                title: '占用场地',
                sortable: true
            },
            {
                field: 'attendance',
                title: '参与人数',
                sortable: true
            },
            {
                field: 'verifyStatus',
                title: '审核状态',
                sortable: true
            },
            {
                field: 'createTime',
                title: '创建日期',
                sortable: true
            },
            {
                field: 'operate',
                title: '操作',
                events: 'operateEvents',
                formatter: operateFormatter
            }
        ],
    })

    // 加载datepicker
    function initDatePicker() {
        $(".date").datetimepicker({
            format: "dd MM yyyy - hh:ii:ss",
            language: "zh-CN",
            autoclose: true,
            forceParse: true,
            todayBtn: true,
            startDate: "2013-02-14 10:00",
            minuteStep: 10
        });
    }

    //加载placelist
    function initPlaceList() {
        $.ajax({
            url: BaseUrl + 'cams/app/getPlaceList',
            type: 'get',
            dataType: 'json',
            success: function (data) {
                //动态生成下拉列表框
                for (i in data) {
                    $("#c_placeId").append("<option value='" + data[i].placeId + "'>" + data[i].placeName + "</option>");
                    $("#e_placeId").append("<option value='" + data[i].placeId + "'>" + data[i].placeName + "</option>");
                }
            },
            error: function (data) {
            }
        });
    }

    //动态生成按钮
    function operateFormatter() {
        return [
            '<button id="editBtn" type="button" onclick="editForm(this)" style="cursor:pointer;" data-target="#editModal"><span class="\n' +
            'glyphicon glyphicon-edit" aria-hidden="true"></button>'
        ].join("");
    }

    //编辑按钮
    function editForm(btn) {
        //显示模态框
        $("#edit_Modal").modal('hideen');
        var row = bootstrapTable.findData($(btn).closest("table"), btn);
        // console.log(row)
        $.each(row, function (key, val) {
            // $("#"+key).val(val);
            $("#modal_edit").find("input[name='" + key + "']").val(val);
            $("#modal_edit").find("select[name='" + key + "']").val(val);
            $("#modal_edit").find("textarea[name='" + key + "']").val(val);
        });
    }

    function createForm(btn) {
        //显示模态框
        $("#create_Modal").modal('show');
    }


    //修改表单
    function commitUpdate() {
        //获取
        /*
         * 通过name选择元素
         * $('input[name="nw"]').val()
         */
        // $('[name="startTime"]','#modal_edit').val()
        var formId = $('input[name="formId"]', '#modal_edit').val();
        var appTitle = $('input[name="appTitle"]', '#modal_edit').val();
        var startTime = $('input[name="startTime"]', '#modal_edit').val();
        var endTime = $('input[name="endTime"]', '#modal_edit').val();
        var attendance = $('input[name="attendance"]', '#modal_edit').val();
        var placeId = $('select[name="placeId"]', '#modal_edit').val();
        var appDesc = $('textarea[name="appDesc"]', '#modal_edit').val();
        //定义json
        var ajaxdata = {
            "formId": formId,
            "appTitle": appTitle,
            "startTime": startTime,
            "endTime": endTime,
            "attendance": attendance,
            "placeId": placeId,
            "appDesc": appDesc
        };
        $.ajax({
            url: BaseUrl + 'cams/app/modifyFormInfoByFormId',
            type: "post",
            data: ajaxdata,
            dataType: "json",
            success: function (data) {
                console.log("执行完成");
                //关闭模态框
                $("#editModal").modal('hide');
            }
        });
    }
    function commitCreate() {
        //获取
        /*
         * 通过name选择元素
         * $('input[name="nw"]').val()
         */
        // $('[name="startTime"]','#modal_create').val()
        var appTitle = $('input[name="appTitle"]', '#modal_create').val();
        var startTime = $('input[name="startTime"]', '#modal_create').val();
        var endTime = $('input[name="endTime"]', '#modal_create').val();
        var attendance = $('input[name="attendance"]', '#modal_create').val();
        var placeId = $('select[name="placeId"]', '#modal_create').val();
        var appDesc = $('textarea[name="appDesc"]', '#modal_create').val();
        //定义json
        var ajaxdata = {
            "appTitle": appTitle,
            "startTime": startTime,
            "endTime": endTime,
            "attendance": attendance,
            "placeId": placeId,
            "appDesc": appDesc
        };
        console.log(ajaxdata);
        // $.ajax({
        //     url: BaseUrl + 'cams/app/modifyFormInfoByFormId',
        //     type: "post",
        //     data: ajaxdata,
        //     dataType: "json",
        //     success: function (data) {
        //         console.log("执行完成");
        //         //关闭模态框
        //         $("#editModal").modal('hide');
        //     }
        // });
    }
</script>
</body>
</html>








